{% if stock %}
<div class="bg-white rounded-2xl shadow-sm overflow-hidden animate-fadeIn">
    <!-- Header Section with Price and Chart Placeholder -->
    <div class="p-6 md:p-8">
        <!-- Top Bar: Company Name, Price, Add to Watchlist -->
        <div class="flex items-start justify-between mb-6">
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                    <!-- Green Icon (Placeholder for logo) -->
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center flex-shrink-0">
                        <svg class="w-7 h-7 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-900">{{ stock.name or stock.symbol }}</h1>
                    </div>
                </div>
            </div>
            
            <!-- Watchlist Star Icon (like screenshot) -->
            <button class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-lg transition">
                <svg class="w-6 h-6 text-gray-400 hover:text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
            </button>
        </div>

        <!-- Price Display -->
        <div class="mb-8">
            {% if stock.current_price %}
            <div class="flex items-baseline gap-3">
                <span class="text-5xl md:text-6xl font-bold text-gray-900">
                    {{ "%.2f"|format(stock.current_price) }} {{ stock.currency or '€' }}
                </span>
                {% if stock.previous_close and stock.current_price %}
                {% set price_change = stock.current_price - stock.previous_close %}
                {% set price_change_pct = (price_change / stock.previous_close * 100) if stock.previous_close else 0 %}
                <span class="text-lg font-semibold {% if price_change >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if price_change >= 0 %}+{% endif %}{{ "%.2f"|format(price_change) }} ({% if price_change >= 0 %}+{% endif %}{{ "%.2f"|format(price_change_pct) }}%)
                </span>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Chart Placeholder (like in screenshot) -->
        <div class="bg-gradient-to-br from-green-50 to-white border border-gray-100 rounded-2xl p-6 mb-8 h-64 flex items-center justify-center">
            <div class="text-center text-gray-400">
                <svg class="w-16 h-16 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                </svg>
                <p class="font-medium">Chart Placeholder</p>
                <p class="text-sm mt-1">Historical price data visualization</p>
            </div>
        </div>

        <!-- Metrics Section -->
        <div class="border-t border-gray-100 pt-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Metrics</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                {% if stock.day_low and stock.day_high %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Day range</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.day_low) }} - {{ "%.2f"|format(stock.day_high) }}</div>
                </div>
                {% endif %}
                
                {% if stock.fifty_two_week_low and stock.fifty_two_week_high %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">52W range</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.fifty_two_week_low) }} - {{ "%.2f"|format(stock.fifty_two_week_high) }}</div>
                </div>
                {% endif %}
                
                {% if stock.market_cap %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Mkt cap</div>
                    <div class="font-semibold text-gray-900">
                        {% if stock.market_cap >= 1000000000000 %}
                            {{ "%.2f"|format(stock.market_cap / 1000000000000) }}T
                        {% elif stock.market_cap >= 1000000000 %}
                            {{ "%.2f"|format(stock.market_cap / 1000000000) }}B
                        {% elif stock.market_cap >= 1000000 %}
                            {{ "%.2f"|format(stock.market_cap / 1000000) }}M
                        {% else %}
                            {{ "{:,}".format(stock.market_cap|int) }}
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                {% if stock.pe_ratio %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">P/E</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.pe_ratio) }}</div>
                </div>
                {% endif %}
                
                {% if stock.open %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Open</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.open) }}</div>
                </div>
                {% endif %}
                
                {% if stock.previous_close %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Close</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.previous_close) }}</div>
                </div>
                {% endif %}
                
                {% if stock.bid %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Bid</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.bid) }}</div>
                </div>
                {% endif %}
                
                {% if stock.ask %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Ask</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.ask) }}</div>
                </div>
                {% endif %}
                
                {% if stock.dividend_yield %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">Div. yield</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.dividend_yield * 100) }}%</div>
                </div>
                {% endif %}
                
                {% if stock.beta %}
                <div>
                    <div class="text-sm text-gray-500 mb-1">52W beta</div>
                    <div class="font-semibold text-gray-900">{{ "%.2f"|format(stock.beta) }}</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Dividends Section (like in screenshot) -->
    {% if stock.dividend_rate or stock.dividend_yield %}
    <div class="border-t border-gray-100 p-6 md:p-8">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Dividends</h3>
        <div class="space-y-3">
            <!-- Placeholder dividend history -->
            <div class="flex items-center justify-between py-3 border-b border-gray-50">
                <div class="flex items-center gap-4">
                    <span class="text-gray-600">Oct 25</span>
                    <div class="flex-1 bg-green-500 h-2 rounded-full" style="max-width: 400px;"></div>
                </div>
                <span class="font-semibold">{% if stock.dividend_rate %}{{ "%.2f"|format(stock.dividend_rate / 4) }} €{% endif %}</span>
            </div>
            <div class="flex items-center justify-between py-3 border-b border-gray-50">
                <div class="flex items-center gap-4">
                    <span class="text-gray-600">Jul 25</span>
                    <div class="flex-1 bg-green-500 h-2 rounded-full" style="max-width: 400px;"></div>
                </div>
                <span class="font-semibold">{% if stock.dividend_rate %}{{ "%.2f"|format(stock.dividend_rate / 4) }} €{% endif %}</span>
            </div>
            <div class="flex items-center justify-between py-3 border-b border-gray-50">
                <div class="flex items-center gap-4">
                    <span class="text-gray-600">Apr 25</span>
                    <div class="flex-1 bg-green-500 h-2 rounded-full" style="max-width: 400px;"></div>
                </div>
                <span class="font-semibold">{% if stock.dividend_rate %}{{ "%.2f"|format(stock.dividend_rate / 4) }} €{% endif %}</span>
            </div>
        </div>
        {% if stock.ex_dividend_date %}
        <p class="text-sm text-gray-500 mt-4">Ex-dividend date: {{ stock.ex_dividend_date|timestamp_to_date }}</p>
        {% endif %}
    </div>
    {% endif %}

    <!-- What analysts say Section (like in screenshot) -->
    {% if stock.target_mean_price or stock.recommendation_key %}
    <div class="border-t border-gray-100 p-6 md:p-8">
        <h3 class="text-xl font-bold text-gray-900 mb-4">What analysts say</h3>
        
        {% if stock.target_mean_price %}
        <div class="mb-6">
            <div class="text-4xl font-bold text-gray-900 mb-2">
                {{ "%.2f"|format(stock.target_mean_price) }} {{ stock.currency or '€' }}
            </div>
            <p class="text-sm text-gray-500">
                Average stock price estimate. The highest estimate is 
                {% if stock.target_high_price %}{{ "%.2f"|format(stock.target_high_price) }} €{% else %}N/A{% endif %} 
                and the lowest estimate is 
                {% if stock.target_low_price %}{{ "%.2f"|format(stock.target_low_price) }} €{% else %}N/A{% endif %}.
                {% if stock.number_of_analyst_opinions %}This result is evaluated by {{ stock.number_of_analyst_opinions }} analysts.{% endif %}
            </p>
        </div>
        {% endif %}
        
        {% if stock.recommendation_key %}
        <div class="flex items-center gap-4 mb-4">
            <div class="relative w-full h-8 bg-gray-100 rounded-full overflow-hidden">
                <!-- Recommendation bar (like screenshot) -->
                <div class="absolute inset-0 flex">
                    <div class="w-1/5 bg-green-500"></div>
                    <div class="w-1/5 bg-green-400"></div>
                    <div class="w-1/5 bg-gray-300"></div>
                    <div class="w-1/5 bg-orange-400"></div>
                    <div class="w-1/5 bg-red-500"></div>
                </div>
            </div>
        </div>
        
        <div class="flex justify-between text-sm text-gray-600">
            <span class="font-medium {% if stock.recommendation_key == 'strong_buy' or stock.recommendation_key == 'buy' %}text-green-600{% endif %}">Buy</span>
            <span class="font-medium">Hold</span>
            <span class="font-medium">Sell</span>
        </div>
        
        <div class="mt-4 text-center">
            <span class="inline-block px-4 py-2 bg-gray-100 rounded-lg font-semibold text-gray-900 capitalize">
                {{ stock.recommendation_key|replace('_', ' ') }} ({{ "%.0f"|format(stock.recommendation_mean * 20) if stock.recommendation_mean else 'N/A' }}%)
            </span>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Information Section (Company Description) -->
    {% if stock.long_business_summary %}
    <div class="border-t border-gray-100 p-6 md:p-8">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Information</h3>
        
        <!-- Tabs (like screenshot) -->
        <div class="flex gap-4 mb-6 border-b border-gray-200">
            <button class="pb-3 px-1 font-semibold text-gray-900 border-b-2 border-gray-900">USA</button>
            {% if stock.exchange %}<button class="pb-3 px-1 text-gray-500 hover:text-gray-900">{{ stock.exchange }}</button>{% endif %}
            {% if stock.sector %}<button class="pb-3 px-1 text-gray-500 hover:text-gray-900">{{ stock.sector }}</button>{% endif %}
            {% if stock.isin %}<button class="pb-3 px-1 text-gray-500 hover:text-gray-900">ISIN</button>{% endif %}
        </div>
        
        <!-- Company Description -->
        <div class="prose max-w-none">
            <p class="text-gray-700 leading-relaxed">
                {{ stock.long_business_summary[:500] }}{% if stock.long_business_summary|length > 500 %}...{% endif %}
            </p>
            
            {% if stock.long_business_summary|length > 500 %}
            <button class="text-blue-600 hover:text-blue-700 font-medium mt-2">Show more ▼</button>
            {% endif %}
        </div>
        
        <!-- Company Details -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            {% if stock.isin %}
            <div>
                <div class="text-sm text-gray-500 mb-1">ISIN</div>
                <div class="font-semibold text-gray-900">{{ stock.isin }}</div>
            </div>
            {% endif %}
            
            {% if stock.wkn %}
            <div>
                <div class="text-sm text-gray-500 mb-1">WKN</div>
                <div class="font-semibold text-gray-900">{{ stock.wkn }}</div>
            </div>
            {% endif %}
            
            {% if stock.symbol %}
            <div>
                <div class="text-sm text-gray-500 mb-1">Name</div>
                <div class="font-semibold text-gray-900">{{ stock.symbol }}</div>
            </div>
            {% endif %}
            
            {% if stock.website %}
            <div class="md:col-span-3">
                <div class="text-sm text-gray-500 mb-1">Website</div>
                <a href="{{ stock.website }}" target="_blank" class="font-semibold text-blue-600 hover:text-blue-700">
                    {{ stock.website }}
                </a>
            </div>
            {% endif %}
            
            {% if stock.full_time_employees %}
            <div>
                <div class="text-sm text-gray-500 mb-1">Employees</div>
                <div class="font-semibold text-gray-900">{{ "{:,}".format(stock.full_time_employees) }}</div>
            </div>
            {% endif %}
            
            {% if stock.city or stock.country %}
            <div class="md:col-span-2">
                <div class="text-sm text-gray-500 mb-1">Headquarters</div>
                <div class="font-semibold text-gray-900">
                    {% if stock.city %}{{ stock.city }}{% endif %}{% if stock.state %}, {{ stock.state }}{% endif %}{% if stock.country %}, {{ stock.country }}{% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- News Section (Placeholder) -->
    <div class="border-t border-gray-100 p-6 md:p-8">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-900">News</h3>
            <div class="flex gap-2">
                <button class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-lg">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <button class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-lg">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- News Cards (Placeholder - like screenshot) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition cursor-pointer">
                <div class="flex items-start gap-3 mb-2">
                    <div class="w-10 h-10 bg-gray-200 rounded-lg flex-shrink-0"></div>
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900 text-sm line-clamp-2">
                            Microsoft to invest over $15 billion in UAE, secures US...
                        </h4>
                    </div>
                </div>
                <p class="text-xs text-gray-500">1 hour ago</p>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition cursor-pointer">
                <div class="flex items-start gap-3 mb-2">
                    <div class="w-10 h-10 bg-gray-200 rounded-lg flex-shrink-0"></div>
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900 text-sm line-clamp-2">
                            BRIEF-US Allows Microsoft To Ship Nvidia AI Chips To...
                        </h4>
                    </div>
                </div>
                <p class="text-xs text-gray-500">1 hour ago</p>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition cursor-pointer">
                <div class="flex items-start gap-3 mb-2">
                    <div class="w-10 h-10 bg-gray-200 rounded-lg flex-shrink-0"></div>
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900 text-sm line-clamp-2">
                            UPDATE 1-Trump says Nvidia's Blackwell AI chip in...
                        </h4>
                    </div>
                </div>
                <p class="text-xs text-gray-500">12 hours ago</p>
            </div>
        </div>
        
        <p class="text-sm text-gray-500 mt-6 text-center">
            News feed coming soon. API integration in progress.
        </p>
    </div>
</div>

<!-- Cache Info -->
{% if stock.cached %}
<div class="mt-4 text-center">
    <span class="inline-block px-3 py-1 bg-blue-50 text-blue-700 text-sm rounded-full">
        ⚡ Cached ({{ stock.cache_age_seconds }}s old)
    </span>
</div>
{% endif %}

{% else %}
<div class="bg-white rounded-2xl shadow-sm p-8 text-center">
    <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
    </div>
    <h3 class="text-xl font-bold text-gray-900 mb-2">No Stock Data</h3>
    <p class="text-gray-600">The requested stock information could not be found.</p>
</div>
{% endif %}
            {% if stock.forward_pe %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">Forward P/E</div>
                <div class="font-bold text-primary">{{ "%.2f"|format(stock.forward_pe) }}</div>
            </div>
            {% endif %}
            
            {% if stock.price_to_book %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">Price to Book</div>
                <div class="font-bold text-primary">{{ "%.2f"|format(stock.price_to_book) }}</div>
            </div>
            {% endif %}
            
            {% if stock.profit_margins %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">Profit Margins</div>
                <div class="font-bold text-primary">{{ "%.2f"|format(stock.profit_margins * 100) }}%</div>
            </div>
            {% endif %}
            
            {% if stock.earnings_growth %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">Earnings Growth</div>
                <div class="font-bold text-primary">{{ "%.2f"|format(stock.earnings_growth * 100) }}%</div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Identifiers -->
    {% if stock.isin or stock.wkn or stock.exchange %}
    <div class="border-t border-gray-100 pt-6 mb-6">
        <h3 class="text-lg font-bold text-primary mb-4">Identifiers</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            {% if stock.isin %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">ISIN</div>
                <div class="font-bold text-primary font-mono">{{ stock.isin }}</div>
            </div>
            {% endif %}
            
            {% if stock.wkn %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">WKN</div>
                <div class="font-bold text-primary font-mono">{{ stock.wkn }}</div>
            </div>
            {% endif %}
            
            {% if stock.exchange %}
            <div class="bg-accent rounded-lg p-3">
                <div class="text-xs text-secondary mb-1 font-semibold">Exchange</div>
                <div class="font-bold text-primary">{{ stock.exchange }}</div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Data Source Footer -->
    <div class="mt-8 pt-6 border-t border-gray-100">
        <div class="flex items-center justify-between text-sm">
            <div class="flex items-center space-x-2 text-secondary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="font-medium">Source: {{ stock.source or 'Yahoo Finance' }}</span>
            </div>
            <div class="flex items-center space-x-3">
                {% if response_time %}
                <span class="text-secondary text-xs">{{ response_time }}ms</span>
                {% endif %}
                {% if stock.cached %}
                <div class="flex items-center space-x-1 text-green-600 bg-green-50 px-3 py-1 rounded-full">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span class="font-semibold text-xs">Cached</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
